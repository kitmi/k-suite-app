"use strict";

require("source-map-support/register");

const path = require('path');

const Feature = require('../enum/Feature');

const Util = require('rk-utils');

const JsonConfigProvider = require('rk-config/lib/JsonConfigProvider');

module.exports = {
  type: Feature.CONF,
  load_: async (app, options) => {
    let devName = options.altUserForTest || Util.runCmdSync('git config --global user.email').trim();

    if (devName === '') {
      throw new Error('Unable to read "user.name" of git config.');
    }

    devName = devName.substr(0, devName.indexOf('@'));
    app.configLoader.provider = new JsonConfigProvider(path.join(app.configPath, app.configName + '.' + devName));
    return app.loadConfig_();
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9kZXZDb25maWdCeUdpdFVzZXIuanMiXSwibmFtZXMiOlsicGF0aCIsInJlcXVpcmUiLCJGZWF0dXJlIiwiVXRpbCIsIkpzb25Db25maWdQcm92aWRlciIsIm1vZHVsZSIsImV4cG9ydHMiLCJ0eXBlIiwiQ09ORiIsImxvYWRfIiwiYXBwIiwib3B0aW9ucyIsImRldk5hbWUiLCJhbHRVc2VyRm9yVGVzdCIsInJ1bkNtZFN5bmMiLCJ0cmltIiwiRXJyb3IiLCJzdWJzdHIiLCJpbmRleE9mIiwiY29uZmlnTG9hZGVyIiwicHJvdmlkZXIiLCJqb2luIiwiY29uZmlnUGF0aCIsImNvbmZpZ05hbWUiLCJsb2FkQ29uZmlnXyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFPQSxNQUFNQSxJQUFJLEdBQUdDLE9BQU8sQ0FBQyxNQUFELENBQXBCOztBQUNBLE1BQU1DLE9BQU8sR0FBR0QsT0FBTyxDQUFDLGlCQUFELENBQXZCOztBQUNBLE1BQU1FLElBQUksR0FBR0YsT0FBTyxDQUFDLFVBQUQsQ0FBcEI7O0FBRUEsTUFBTUcsa0JBQWtCLEdBQUdILE9BQU8sQ0FBQyxrQ0FBRCxDQUFsQzs7QUFFQUksTUFBTSxDQUFDQyxPQUFQLEdBQWlCO0FBTWJDLEVBQUFBLElBQUksRUFBRUwsT0FBTyxDQUFDTSxJQU5EO0FBZWJDLEVBQUFBLEtBQUssRUFBRSxPQUFPQyxHQUFQLEVBQVlDLE9BQVosS0FBd0I7QUFDM0IsUUFBSUMsT0FBTyxHQUFHRCxPQUFPLENBQUNFLGNBQVIsSUFBMEJWLElBQUksQ0FBQ1csVUFBTCxDQUFnQixnQ0FBaEIsRUFBa0RDLElBQWxELEVBQXhDOztBQUNBLFFBQUlILE9BQU8sS0FBSyxFQUFoQixFQUFvQjtBQUNoQixZQUFNLElBQUlJLEtBQUosQ0FBVSwyQ0FBVixDQUFOO0FBQ0g7O0FBRURKLElBQUFBLE9BQU8sR0FBR0EsT0FBTyxDQUFDSyxNQUFSLENBQWUsQ0FBZixFQUFrQkwsT0FBTyxDQUFDTSxPQUFSLENBQWdCLEdBQWhCLENBQWxCLENBQVY7QUFFQVIsSUFBQUEsR0FBRyxDQUFDUyxZQUFKLENBQWlCQyxRQUFqQixHQUE0QixJQUFJaEIsa0JBQUosQ0FBdUJKLElBQUksQ0FBQ3FCLElBQUwsQ0FBVVgsR0FBRyxDQUFDWSxVQUFkLEVBQTBCWixHQUFHLENBQUNhLFVBQUosR0FBaUIsR0FBakIsR0FBdUJYLE9BQWpELENBQXZCLENBQTVCO0FBQ0EsV0FBT0YsR0FBRyxDQUFDYyxXQUFKLEVBQVA7QUFDSDtBQXpCWSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEVuYWJsZSBkZXZlbG9wZXIgc3BlY2lmaWMgY29uZmlnIGlkZW50aWZpZWQgYnkgZ2l0IHVzZXIgbmFtZS5cbiAqIEBtb2R1bGUgRmVhdHVyZV9EZXZDb25maWdCeUdpdFVzZXJcbiAqL1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgRmVhdHVyZSA9IHJlcXVpcmUoJy4uL2VudW0vRmVhdHVyZScpO1xuY29uc3QgVXRpbCA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5cbmNvbnN0IEpzb25Db25maWdQcm92aWRlciA9IHJlcXVpcmUoJ3JrLWNvbmZpZy9saWIvSnNvbkNvbmZpZ1Byb3ZpZGVyJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBjb25maWd1cmF0aW9uIHN0YWdlXG4gICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAqL1xuICAgIHR5cGU6IEZlYXR1cmUuQ09ORixcblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge0FwcH0gYXBwIC0gVGhlIGNsaSBhcHAgbW9kdWxlIG9iamVjdFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucyBmb3IgdGhlIGZlYXR1cmUgICAgIFxuICAgICAqIEBwYXJhbSB7c3RyaW5nfSBbb3B0aW9ucy5hbHRVc2VyRm9yVGVzdF0gLSBBbHRlcm5hdGl2ZSB1c2VybmFtZSBmb3IgdGVzdCBwdXJwb3NlLCBpZiBnaXZlbiwgdGhpcyBmZWF0dXJlIHdpbGwgbm90IGdldCBnaXQgdXNlciBidXQgdXNlIHRoaXMgZ2l2ZW4gdmFsdWUgaW5zdGVhZFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjwqPn1cbiAgICAgKi9cbiAgICBsb2FkXzogYXN5bmMgKGFwcCwgb3B0aW9ucykgPT4ge1xuICAgICAgICBsZXQgZGV2TmFtZSA9IG9wdGlvbnMuYWx0VXNlckZvclRlc3QgfHwgVXRpbC5ydW5DbWRTeW5jKCdnaXQgY29uZmlnIC0tZ2xvYmFsIHVzZXIuZW1haWwnKS50cmltKCk7XG4gICAgICAgIGlmIChkZXZOYW1lID09PSAnJykge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdVbmFibGUgdG8gcmVhZCBcInVzZXIubmFtZVwiIG9mIGdpdCBjb25maWcuJyk7XG4gICAgICAgIH0gICAgICAgICAgICBcblxuICAgICAgICBkZXZOYW1lID0gZGV2TmFtZS5zdWJzdHIoMCwgZGV2TmFtZS5pbmRleE9mKCdAJykpO1xuXG4gICAgICAgIGFwcC5jb25maWdMb2FkZXIucHJvdmlkZXIgPSBuZXcgSnNvbkNvbmZpZ1Byb3ZpZGVyKHBhdGguam9pbihhcHAuY29uZmlnUGF0aCwgYXBwLmNvbmZpZ05hbWUgKyAnLicgKyBkZXZOYW1lKSk7XG4gICAgICAgIHJldHVybiBhcHAubG9hZENvbmZpZ18oKTtcbiAgICB9XG59OyJdfQ==