"use strict";

require("source-map-support/register");

const {
  _
} = require('rk-utils');

const Feature = require('../enum/Feature');

const {
  tryRequire
} = require('../utils/Helpers');

const AllowedMethods = {
  'get': 'get',
  'post': 'post',
  'download': 'get'
};

const basicAuth = (req, authInfo) => {
  req.auth(authInfo.username, authInfo.password);
};

const bearerAuth = (req, authInfo) => {
  req.set('Authorization', `Bearer ${authInfo}`);
};

class SimpleCrawler {
  constructor(settings) {
    this.agent = tryRequire('superagent');

    if (settings.saveCookies) {
      this.agent = this.agent.agent();
    }

    let timeout = {
      response: 5000,
      deadline: 60000
    };

    if (settings.responseTimeout) {
      timeout.response = settings.responseTimeout;
    }

    if (settings.deadlineTimeout) {
      timeout.deadline = settings.deadlineTimeout;
    }

    if (settings.parser) {
      if (settings.parser === 'cheerio') {
        let parser = tryRequire('cheerio');

        this._afterReceive = text => {
          return parser.load(text);
        };
      }
    }

    this._beforeSend = req => {
      req.timeout(timeout);

      if (settings.basicAuth) {
        basicAuth(req, settings.basicAuth);
      } else if (settings.bearerAuth) {
        bearerAuth(req, settings.bearerAuth);
      }
    };
  }

  async _sendRequest_(req) {
    this._beforeSend(req);

    req.buffer(true);

    try {
      let res = await req;
      return this._afterReceive ? this._afterReceive(res.text) : res.text;
    } catch (error) {
      if (this.onErrorHandler) {
        await this.onErrorHandler(error);
      }

      if (error.response) {
        let {
          status,
          body,
          text
        } = error.response;
        let message = body && body.error || error.response.error && error.response.error.message || text;
        error.message = message;
        error.status = status;
      }

      throw error;
    }
  }

  async get_(url, query) {
    let req = this.agent.get(url);

    if (query) {
      req.query(query);
    }

    return this._sendRequest_(req);
  }

  async post_(url, query, body) {
    let req = this.agent.post(url);

    if (query) {
      req.query(query);
    }

    if (body) {
      req.send(body);
    }

    return this._sendRequest_(req);
  }

}

module.exports = {
  type: Feature.PLUGIN,
  load_: async function (app, settings) {
    let client = new SimpleCrawler(settings);
    app.registerService('simpleCrawler', client);
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9zaW1wbGVDcmF3bGVyLmpzIl0sIm5hbWVzIjpbIl8iLCJyZXF1aXJlIiwiRmVhdHVyZSIsInRyeVJlcXVpcmUiLCJBbGxvd2VkTWV0aG9kcyIsImJhc2ljQXV0aCIsInJlcSIsImF1dGhJbmZvIiwiYXV0aCIsInVzZXJuYW1lIiwicGFzc3dvcmQiLCJiZWFyZXJBdXRoIiwic2V0IiwiU2ltcGxlQ3Jhd2xlciIsImNvbnN0cnVjdG9yIiwic2V0dGluZ3MiLCJhZ2VudCIsInNhdmVDb29raWVzIiwidGltZW91dCIsInJlc3BvbnNlIiwiZGVhZGxpbmUiLCJyZXNwb25zZVRpbWVvdXQiLCJkZWFkbGluZVRpbWVvdXQiLCJwYXJzZXIiLCJfYWZ0ZXJSZWNlaXZlIiwidGV4dCIsImxvYWQiLCJfYmVmb3JlU2VuZCIsIl9zZW5kUmVxdWVzdF8iLCJidWZmZXIiLCJyZXMiLCJlcnJvciIsIm9uRXJyb3JIYW5kbGVyIiwic3RhdHVzIiwiYm9keSIsIm1lc3NhZ2UiLCJnZXRfIiwidXJsIiwicXVlcnkiLCJnZXQiLCJwb3N0XyIsInBvc3QiLCJzZW5kIiwibW9kdWxlIiwiZXhwb3J0cyIsInR5cGUiLCJQTFVHSU4iLCJsb2FkXyIsImFwcCIsImNsaWVudCIsInJlZ2lzdGVyU2VydmljZSJdLCJtYXBwaW5ncyI6Ijs7OztBQUFBLE1BQU07QUFBRUEsRUFBQUE7QUFBRixJQUFRQyxPQUFPLENBQUMsVUFBRCxDQUFyQjs7QUFDQSxNQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxpQkFBRCxDQUF2Qjs7QUFDQSxNQUFNO0FBQUVFLEVBQUFBO0FBQUYsSUFBaUJGLE9BQU8sQ0FBQyxrQkFBRCxDQUE5Qjs7QUFFQSxNQUFNRyxjQUFjLEdBQUc7QUFDbkIsU0FBTyxLQURZO0FBRW5CLFVBQVEsTUFGVztBQUduQixjQUFZO0FBSE8sQ0FBdkI7O0FBTUEsTUFBTUMsU0FBUyxHQUFHLENBQUNDLEdBQUQsRUFBTUMsUUFBTixLQUFtQjtBQUNqQ0Qs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IjpbImNvbnN0IHsgXyB9ID0gcmVxdWlyZSgncmstdXRpbHMnKTtcbmNvbnN0IEZlYXR1cmUgPSByZXF1aXJlKCcuLi9lbnVtL0ZlYXR1cmUnKTtcbmNvbnN0IHsgdHJ5UmVxdWlyZSB9ID0gcmVxdWlyZSgnLi4vdXRpbHMvSGVscGVycycpO1xuXG5jb25zdCBBbGxvd2VkTWV0aG9kcyA9IHtcbiAgICAnZ2V0JzogJ2dldCcsXG4gICAgJ3Bvc3QnOiAncG9zdCcsXG4gICAgJ2Rvd25sb2FkJzogJ2dldCdcbn07XG5cbmNvbnN0IGJhc2ljQXV0aCA9IChyZXEsIGF1dGhJbmZvKSA9PiB7XG4gICAgcmVxLmF1dGgoYXV0aEluZm8udXNlcm5hbWUsIGF1dGhJbmZvLnBhc3N3b3JkKTtcbn1cblxuY29uc3QgYmVhcmVyQXV0aCA9IChyZXEsIGF1dGhJbmZvKSA9PiB7XG4gICAgcmVxLnNldCgnQXV0aG9yaXphdGlvbicsIGBCZWFyZXIgJHthdXRoSW5mb31gKTtcbn1cblxuY2xhc3MgU2ltcGxlQ3Jhd2xlciB7XG4gICAgY29uc3RydWN0b3Ioc2V0dGluZ3MpIHtcbiAgICAgICAgdGhpcy5hZ2VudCA9IHRyeVJlcXVpcmUoJ3N1cGVyYWdlbnQnKTtcblxuICAgICAgICBpZiAoc2V0dGluZ3Muc2F2ZUNvb2tpZXMpIHtcbiAgICAgICAgICAgIHRoaXMuYWdlbnQgPSB0aGlzLmFnZW50LmFnZW50KCk7IC8vIGNyZWF0ZSBhIHNlcGFyYXRlIGNvb2tpZSBqYXJcbiAgICAgICAgfVxuXG4gICAgICAgIC8vdGltZW91dFxuICAgICAgICBsZXQgdGltZW91dCA9IHtcbiAgICAgICAgICAgIHJlc3BvbnNlOiA1MDAwLCAvLyBXYWl0IDUgc2Vjb25kcyBmb3IgdGhlIHNlcnZlciB0byBzdGFydCBzZW5kaW5nLFxuICAgICAgICAgICAgZGVhZGxpbmU6IDYwMDAwIC8vIGJ1dCBhbGxvdyAxIG1pbnV0ZSBmb3IgdGhlIGZpbGUgdG8gZmluaXNoIGxvYWRpbmcuXG4gICAgICAgIH07XG5cbiAgICAgICAgaWYgKHNldHRpbmdzLnJlc3BvbnNlVGltZW91dCkge1xuICAgICAgICAgICAgdGltZW91dC5yZXNwb25zZSA9IHNldHRpbmdzLnJlc3BvbnNlVGltZW91dDtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChzZXR0aW5ncy5kZWFkbGluZVRpbWVvdXQpIHtcbiAgICAgICAgICAgIHRpbWVvdXQuZGVhZGxpbmUgPSBzZXR0aW5ncy5kZWFkbGluZVRpbWVvdXQ7XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2V0dGluZ3MucGFyc2VyKSB7XG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MucGFyc2VyID09PSAnY2hlZXJpbycpIHtcbiAgICAgICAgICAgICAgICBsZXQgcGFyc2VyID0gdHJ5UmVxdWlyZSgnY2hlZXJpbycpO1xuICAgICAgICAgICAgICAgIHRoaXMuX2FmdGVyUmVjZWl2ZSA9ICh0ZXh0KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwYXJzZXIubG9hZCh0ZXh0KTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgfSBcbiAgICAgICAgfSBcblxuICAgICAgICB0aGlzLl9iZWZvcmVTZW5kID0gKHJlcSkgPT4ge1xuICAgICAgICAgICAgLy90aW1lb3V0XG4gICAgICAgICAgICByZXEudGltZW91dCh0aW1lb3V0KTtcblxuICAgICAgICAgICAgLy9hdXRoXG4gICAgICAgICAgICBpZiAoc2V0dGluZ3MuYmFzaWNBdXRoKSB7XG4gICAgICAgICAgICAgICAgYmFzaWNBdXRoKHJlcSwgc2V0dGluZ3MuYmFzaWNBdXRoKTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoc2V0dGluZ3MuYmVhcmVyQXV0aCkge1xuICAgICAgICAgICAgICAgIGJlYXJlckF1dGgocmVxLCBzZXR0aW5ncy5iZWFyZXJBdXRoKTtcbiAgICAgICAgICAgIH0gICAgICBcbiAgICAgICAgfTsgICAgICAgICBcbiAgICB9XG5cbiAgICBhc3luYyBfc2VuZFJlcXVlc3RfKHJlcSkge1xuICAgICAgICB0aGlzLl9iZWZvcmVTZW5kKHJlcSk7XG5cbiAgICAgICAgcmVxLmJ1ZmZlcih0cnVlKTtcblxuICAgICAgICB0cnkge1xuICAgICAgICAgICAgbGV0IHJlcyA9IGF3YWl0IHJlcTtcbiAgICAgICAgICAgIHJldHVybiB0aGlzLl9hZnRlclJlY2VpdmUgPyB0aGlzLl9hZnRlclJlY2VpdmUocmVzLnRleHQpIDogcmVzLnRleHQ7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5vbkVycm9ySGFuZGxlcikge1xuICAgICAgICAgICAgICAgIGF3YWl0IHRoaXMub25FcnJvckhhbmRsZXIoZXJyb3IpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoZXJyb3IucmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBsZXQgeyBzdGF0dXMsIGJvZHksIHRleHQgfSA9IGVycm9yLnJlc3BvbnNlO1xuXG4gICAgICAgICAgICAgICAgbGV0IG1lc3NhZ2UgPSAoYm9keSAmJiBib2R5LmVycm9yKSB8fCAoZXJyb3IucmVzcG9uc2UuZXJyb3IgJiYgZXJyb3IucmVzcG9uc2UuZXJyb3IubWVzc2FnZSkgfHwgdGV4dDtcbiAgICAgICAgICAgICAgICBlcnJvci5tZXNzYWdlID0gbWVzc2FnZTsgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgZXJyb3Iuc3RhdHVzID0gc3RhdHVzO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB0aHJvdyBlcnJvcjtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIGFzeW5jIGdldF8odXJsLCBxdWVyeSkge1xuICAgICAgICBsZXQgcmVxID0gdGhpcy5hZ2VudC5nZXQodXJsKTtcblxuICAgICAgICBpZiAocXVlcnkpIHtcbiAgICAgICAgICAgIHJlcS5xdWVyeShxdWVyeSk7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5fc2VuZFJlcXVlc3RfKHJlcSk7XG4gICAgfVxuXG4gICAgYXN5bmMgcG9zdF8odXJsLCBxdWVyeSwgYm9keSkge1xuICAgICAgICBsZXQgcmVxID0gdGhpcy5hZ2VudC5wb3N0KHVybCk7XG4gICAgICAgIGlmIChxdWVyeSkge1xuICAgICAgICAgICAgcmVxLnF1ZXJ5KHF1ZXJ5KTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChib2R5KSB7XG4gICAgICAgICAgICByZXEuc2VuZChib2R5KTsgICAgICAgICAgICBcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9zZW5kUmVxdWVzdF8ocmVxKTtcbiAgICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBwbHVnaW4gc3RhZ2VcbiAgICAgKiBAbWVtYmVyIHtzdHJpbmd9XG4gICAgICovXG4gICAgdHlwZTogRmVhdHVyZS5QTFVHSU4sXG5cbiAgICAvKipcbiAgICAgKiBMb2FkIHRoZSBmZWF0dXJlXG4gICAgICogQHBhcmFtIHtBcHB9IGFwcCAtIFRoZSBjbGkgYXBwIG1vZHVsZSBvYmplY3RcbiAgICAgKiBAcGFyYW0ge29iamVjdH0gc2V0dGluZ3MgLSBTZXR0aW5ncyBvZiBzaW1wbGUgY3Jhd2xlclxuICAgICAqIEBwcm9wZXJ0eSB7Ym9vbGVhbn0gW3NldHRpbmdzLnNhdmVDb29raWVzXSAtIEZsYWcgb2Ygc2F2ZSBjb29raWVzIG9yIG5vdFxuICAgICAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBbc2V0dGluZ3MuYmFzaWNBdXRoXSAtIEJhc2ljIGF1dGhlbnRpY2F0aW9uXG4gICAgICogQHByb3BlcnR5IHtzdHJpbmd9IFtzZXR0aW5ncy5iZWFyZXJBdXRoXSAtIEJlYXJlciBhdXRoZW50aWNhdGlvblxuICAgICAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBbc2V0dGluZ3MucmVzcG9uc2VUaW1lb3V0XSAtIFNldHMgbWF4aW11bSB0aW1lIChtcykgdG8gd2FpdCBmb3IgdGhlIGZpcnN0IGJ5dGUgdG8gYXJyaXZlIGZyb20gdGhlIHNlcnZlciwgYnV0IGl0IGRvZXMgbm90IGxpbWl0IGhvdyBsb25nIHRoZSBlbnRpcmUgZG93bmxvYWQgY2FuIHRha2UuXG4gICAgICogQHByb3BlcnR5IHtudW1iZXJ9IFtzZXR0aW5ncy5kZWFkbGluZVRpbWVvdXRdIC0gU2V0cyBhIGRlYWRsaW5lIChtcykgZm9yIHRoZSBlbnRpcmUgcmVxdWVzdCAoaW5jbHVkaW5nIGFsbCB1cGxvYWRzLCByZWRpcmVjdHMsIHNlcnZlciBwcm9jZXNzaW5nIHRpbWUpIHRvIGNvbXBsZXRlLlxuICAgICAqIFxuICAgICAqIEByZXR1cm5zIHtQcm9taXNlLjwqPn1cbiAgICAgKi9cbiAgICBsb2FkXzogYXN5bmMgZnVuY3Rpb24gKGFwcCwgc2V0dGluZ3MpIHtcbiAgICAgICAgbGV0IGNsaWVudCA9IG5ldyBTaW1wbGVDcmF3bGVyKHNldHRpbmdzKTtcbiAgICAgICAgYXBwLnJlZ2lzdGVyU2VydmljZSgnc2ltcGxlQ3Jhd2xlcicsIGNsaWVudCk7ICAgIFxuICAgIH1cbn07Il19