"use strict";

require("source-map-support/register");

const path = require('path');

const Feature = require('../enum/Feature');

const Util = require('rk-utils');

const JsonConfigProvider = require('rk-config/lib/JsonConfigProvider');

module.exports = {
  type: Feature.CONF,
  load_: async (app, options) => {
    let hostName = options.altUserForTest || Util.runCmdSync('hostname').trim();

    if (hostName === '') {
      throw new Error('Unable to read "hostname" from environment.');
    }

    app.configLoader.provider = new JsonConfigProvider(path.join(app.configPath, app.configName + '.' + hostName + '.json'));
    return app.loadConfig_();
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9mZWF0dXJlcy9jb25maWdCeUhvc3RuYW1lLmpzIl0sIm5hbWVzIjpbInBhdGgiLCJyZXF1aXJlIiwiRmVhdHVyZSIsIlV0aWwiLCJKc29uQ29uZmlnUHJvdmlkZXIiLCJtb2R1bGUiLCJleHBvcnRzIiwidHlwZSIsIkNPTkYiLCJsb2FkXyIsImFwcCIsIm9wdGlvbnMiLCJob3N0TmFtZSIsImFsdFVzZXJGb3JUZXN0IiwicnVuQ21kU3luYyIsInRyaW0iLCJFcnJvciIsImNvbmZpZ0xvYWRlciIsInByb3ZpZGVyIiwiam9pbiIsImNvbmZpZ1BhdGgiLCJjb25maWdOYW1lIiwibG9hZENvbmZpZ18iXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBT0EsTUFBTUEsSUFBSSxHQUFHQyxPQUFPLENBQUMsTUFBRCxDQUFwQjs7QUFDQSxNQUFNQyxPQUFPLEdBQUdELE9BQU8sQ0FBQyxpQkFBRCxDQUF2Qjs7QUFDQSxNQUFNRSxJQUFJLEdBQUdGLE9BQU8sQ0FBQyxVQUFELENBQXBCOztBQUVBLE1BQU1HLGtCQUFrQixHQUFHSCxPQUFPLENBQUMsa0NBQUQsQ0FBbEM7O0FBRUFJLE1BQU0sQ0FBQ0MsT0FBUCxHQUFpQjtBQU1iQyxFQUFBQSxJQUFJLEVBQUVMLE9BQU8sQ0FBQ00sSUFORDtBQWNiQyxFQUFBQSxLQUFLLEVBQUUsT0FBT0MsR0FBUCxFQUFZQyxPQUFaLEtBQXdCO0FBQzNCLFFBQUlDLFFBQVEsR0FBR0QsT0FBTyxDQUFDRSxjQUFSLElBQTBCVixJQUFJLENBQUNXLFVBQUwsQ0FBZ0IsVUFBaEIsRUFBNEJDLElBQTVCLEVBQXpDOztBQUNBLFFBQUlILFFBQVEsS0FBSyxFQUFqQixFQUFxQjtBQUNqQixZQUFNLElBQUlJLEtBQUosQ0FBVSw2Q0FBVixDQUFOO0FBQ0g7O0FBRUROLElBQUFBLEdBQUcsQ0FBQ08sWUFBSixDQUFpQkMsUUFBakIsR0FBNEIsSUFBSWQsa0JBQUosQ0FBdUJKLElBQUksQ0FBQ21CLElBQUwsQ0FBVVQsR0FBRyxDQUFDVSxVQUFkLEVBQTBCVixHQUFHLENBQUNXLFVBQUosR0FBaUIsR0FBakIsR0FBdUJULFFBQXZCLEdBQWtDLE9BQTVELENBQXZCLENBQTVCO0FBQ0EsV0FBT0YsR0FBRyxDQUFDWSxXQUFKLEVBQVA7QUFDSDtBQXRCWSxDQUFqQiIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIEVuYWJsZSBzZXJ2ZXIgc3BlY2lmaWMgY29uZmlnIGlkZW50aWZpZWQgYnkgaG9zdCBuYW1lLlxuICogQG1vZHVsZSBGZWF0dXJlX0NvbmZpZ0J5SG9zdG5hbWVcbiAqL1xuXG5jb25zdCBwYXRoID0gcmVxdWlyZSgncGF0aCcpO1xuY29uc3QgRmVhdHVyZSA9IHJlcXVpcmUoJy4uL2VudW0vRmVhdHVyZScpO1xuY29uc3QgVXRpbCA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5cbmNvbnN0IEpzb25Db25maWdQcm92aWRlciA9IHJlcXVpcmUoJ3JrLWNvbmZpZy9saWIvSnNvbkNvbmZpZ1Byb3ZpZGVyJyk7XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuXG4gICAgLyoqXG4gICAgICogVGhpcyBmZWF0dXJlIGlzIGxvYWRlZCBhdCBjb25maWd1cmF0aW9uIHN0YWdlXG4gICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAqL1xuICAgIHR5cGU6IEZlYXR1cmUuQ09ORixcblxuICAgIC8qKlxuICAgICAqIExvYWQgdGhlIGZlYXR1cmVcbiAgICAgKiBAcGFyYW0ge0FwcH0gYXBwIC0gVGhlIGNsaSBhcHAgbW9kdWxlIG9iamVjdFxuICAgICAqIEBwYXJhbSB7b2JqZWN0fSBvcHRpb25zIC0gT3B0aW9ucyBmb3IgdGhlIGZlYXR1cmVcbiAgICAgKiBAcmV0dXJucyB7UHJvbWlzZS48Kj59XG4gICAgICovXG4gICAgbG9hZF86IGFzeW5jIChhcHAsIG9wdGlvbnMpID0+IHtcbiAgICAgICAgbGV0IGhvc3ROYW1lID0gb3B0aW9ucy5hbHRVc2VyRm9yVGVzdCB8fCBVdGlsLnJ1bkNtZFN5bmMoJ2hvc3RuYW1lJykudHJpbSgpO1xuICAgICAgICBpZiAoaG9zdE5hbWUgPT09ICcnKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1VuYWJsZSB0byByZWFkIFwiaG9zdG5hbWVcIiBmcm9tIGVudmlyb25tZW50LicpO1xuICAgICAgICB9ICAgICAgICAgICAgXG5cbiAgICAgICAgYXBwLmNvbmZpZ0xvYWRlci5wcm92aWRlciA9IG5ldyBKc29uQ29uZmlnUHJvdmlkZXIocGF0aC5qb2luKGFwcC5jb25maWdQYXRoLCBhcHAuY29uZmlnTmFtZSArICcuJyArIGhvc3ROYW1lICsgJy5qc29uJykpO1xuICAgICAgICByZXR1cm4gYXBwLmxvYWRDb25maWdfKCk7XG4gICAgfVxufTsiXX0=