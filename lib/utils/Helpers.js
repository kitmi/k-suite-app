"use strict";

require("source-map-support/register");

const {
  _
} = require('rk-utils');

exports.dependsOn = function (features, app, fromFeature) {
  let hasNotEnabled = _.find(_.castArray(features), feature => !app.enabled(feature));

  if (hasNotEnabled) {
    throw new Error(`"${fromFeature}" feature requires "${hasNotEnabled}" feature to be enabled.`);
  }
};

exports.splitControllerAction = function (actionString) {
  let pos = actionString.lastIndexOf('.');

  if (pos <= 0) {
    throw new Error(`Unrecognized controller.action syntax: ${actionString}.`);
  }

  let controller = actionString.substr(0, pos);
  let action = actionString.substr(pos + 1);
  return {
    controller,
    action
  };
};

exports.tryRequire = function (packageName) {
  function tryRequireBy(packageName, mainModule, throwWhenNotFound) {
    try {
      return mainModule.require(packageName);
    } catch (error) {
      if (error.code === 'MODULE_NOT_FOUND') {
        if (throwWhenNotFound) {
          let pkgPaths = packageName.split('/');
          let npmPkgName = pkgPaths[0];

          if (pkgPaths[0].startsWith('@') && pkgPaths.length > 1) {
            npmPkgName += '/' + pkgPaths[1];
          }

          throw new Error(`Module "${packageName}" not found. Try run "npm install ${npmPkgName}" to install the dependency.`);
        }

        return undefined;
      }

      throw error;
    }
  }

  return tryRequireBy(packageName, module) || tryRequireBy(packageName, require.main, true);
};

exports.withStatus = (Base, STATUS) => {
  var _temp;

  return _temp = class extends Base {
    constructor(...args) {
      super(...args);
      this.status = STATUS;
    }

  }, _temp;
};

exports.withExpose = Base => {
  var _temp2;

  return _temp2 = class extends Base {
    constructor(...args) {
      super(...args);
      this.expose = true;
    }

  }, _temp2;
};

exports.withName = Base => class extends Base {
  constructor(...args) {
    super(...args);
    this.name = this.constructor.name;
  }

};

exports.withExtraInfo = Base => class extends Base {
  constructor(...args) {
    super(...args);
    let expectedNumArgs = super.constructor.length;

    if (args.length > expectedNumArgs) {
      let extra = args.slice(expectedNumArgs);
      this.extraInfo = extra.length > 1 ? extra : extra[0];
    }
  }

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9IZWxwZXJzLmpzIl0sIm5hbWVzIjpbIl8iLCJyZXF1aXJlIiwiZXhwb3J0cyIsImRlcGVuZHNPbiIsImZlYXR1cmVzIiwiYXBwIiwiZnJvbUZlYXR1cmUiLCJoYXNOb3RFbmFibGVkIiwiZmluZCIsImNhc3RBcnJheSIsImZlYXR1cmUiLCJlbmFibGVkIiwiRXJyb3IiLCJzcGxpdENvbnRyb2xsZXJBY3Rpb24iLCJhY3Rpb25TdHJpbmciLCJwb3MiLCJsYXN0SW5kZXhPZiIsImNvbnRyb2xsZXIiLCJzdWJzdHIiLCJhY3Rpb24iLCJ0cnlSZXF1aXJlIiwicGFja2FnZU5hbWUiLCJ0cnlSZXF1aXJlQnkiLCJtYWluTW9kdWxlIiwidGhyb3dXaGVuTm90Rm91bmQiLCJlcnJvciIsImNvZGUiLCJwa2dQYXRocyIsInNwbGl0IiwibnBtUGtnTmFtZSIsInN0YXJ0c1dpdGgiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJtb2R1bGUiLCJtYWluIiwid2l0aFN0YXR1cyIsIkJhc2UiLCJTVEFUVVMiLCJzdGF0dXMiLCJ3aXRoRXhwb3NlIiwiZXhwb3NlIiwid2l0aE5hbWUiLCJjb25zdHJ1Y3RvciIsImFyZ3MiLCJuYW1lIiwid2l0aEV4dHJhSW5mbyIsImV4cGVjdGVkTnVtQXJncyIsImV4dHJhIiwic2xpY2UiLCJleHRyYUluZm8iXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBT0MsTUFBTTtBQUFFQSxFQUFBQTtBQUFGLElBQVFDLE9BQU8sQ0FBQyxVQUFELENBQXJCOztBQU9EQyxPQUFPLENBQUNDLFNBQVIsR0FBb0IsVUFBVUMsUUFBVixFQUFvQkMsR0FBcEIsRUFBeUJDLFdBQXpCLEVBQXNDO0FBQ3RELE1BQUlDLGFBQWEsR0FBR1AsQ0FBQyxDQUFDUSxJQUFGLENBQU9SLENBQUMsQ0FBQ1MsU0FBRixDQUFZTCxRQUFaLENBQVAsRUFBOEJNLE9BQU8sSUFBSSxDQUFDTCxHQUFHLENBQUNNLE9BQUosQ0FBWUQsT0FBWixDQUExQyxDQUFw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QUFXLENBQUMsR0FBR0MsSUFBSixFQUFVO0FBQ2pCLFVBQU0sR0FBR0EsSUFBVDtBQUVBLFFBQUlHLGVBQWUsR0FBRyxNQUFNSixXQUFOLENBQWtCWCxNQUF4Qzs7QUFFQSxRQUFJWSxJQUFJLENBQUNaLE1BQUwsR0FBY2UsZUFBbEIsRUFBbUM7QUFDL0IsVUFBSUMsS0FBSyxHQUFHSixJQUFJLENBQUNLLEtBQUwsQ0FBV0YsZUFBWCxDQUFaO0FBTUEsV0FBS0csU0FBTCxHQUFpQkYsS0FBSyxDQUFDaEIsTUFBTixHQUFlLENBQWYsR0FBbUJnQixLQUFuQixHQUEyQkEsS0FBSyxDQUFDLENBQUQsQ0FBakQ7QUFDSDtBQUNKOztBQWZnRCxDQUFyRCIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG4vKipcbiAqIENvbW1vbiBoZWxwZXJzIGZvciBzZXJ2aWNlIGNvbnRhaW5lci5cbiAqIEBtb2R1bGUgSGVscGVyc1xuICovIFxuXG4gY29uc3QgeyBfIH0gPSByZXF1aXJlKCdyay11dGlscycpO1xuXG4gLyoqXG4gICogQHBhcmFtIHtzdHJpbmd8YXJyYXkuPHN0cmluZz59IGZlYXR1cmVzIC0gRGVwZW5kZW5jaWVzIG9mIG90aGVyIGZlYXR1cmVzLlxuICAqIEBwYXJhbSB7U2VydmljZUNvbnRhaW5lcn0gYXBwIC0gT3JpZ2luIHNlcnZpY2UgY29udGFpbmVyIGFwcC5cbiAgKiBAcGFyYW0ge3N0cmluZ30gZnJvbUZlYXR1cmUgLSBEZXBlbmRlbnQgZmVhdHVyZS5cbiAgKi9cbmV4cG9ydHMuZGVwZW5kc09uID0gZnVuY3Rpb24gKGZlYXR1cmVzLCBhcHAsIGZyb21GZWF0dXJlKSB7XG4gICAgbGV0IGhhc05vdEVuYWJsZWQgPSBfLmZpbmQoXy5jYXN0QXJyYXkoZmVhdHVyZXMpLCBmZWF0dXJlID0+ICFhcHAuZW5hYmxlZChmZWF0dXJlKSk7XG5cbiAgICBpZiAoaGFzTm90RW5hYmxlZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFwiJHtmcm9tRmVhdHVyZX1cIiBmZWF0dXJlIHJlcXVpcmVzIFwiJHtoYXNOb3RFbmFibGVkfVwiIGZlYXR1cmUgdG8gYmUgZW5hYmxlZC5gKTtcbiAgICB9XG59O1xuXG5leHBvcnRzLnNwbGl0Q29udHJvbGxlckFjdGlvbiA9IGZ1bmN0aW9uIChhY3Rpb25TdHJpbmcpIHtcbiAgICBsZXQgcG9zID0gYWN0aW9uU3RyaW5nLmxhc3RJbmRleE9mKCcuJyk7XG4gICAgaWYgKHBvcyA8PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgVW5yZWNvZ25pemVkIGNvbnRyb2xsZXIuYWN0aW9uIHN5bnRheDogJHthY3Rpb25TdHJpbmd9LmApO1xuICAgIH1cblxuICAgIGxldCBjb250cm9sbGVyID0gYWN0aW9uU3RyaW5nLnN1YnN0cigwLCBwb3MpO1xuICAgIGxldCBhY3Rpb24gPSBhY3Rpb25TdHJpbmcuc3Vic3RyKHBvcyArIDEpO1xuXG4gICAgcmV0dXJuIHsgY29udHJvbGxlciwgYWN0aW9uIH07XG59O1xuXG4vKipcbiAqIFRyeSByZXF1aXJlIGEgcGFja2FnZSBtb2R1bGUgYW5kIHNob3cgaW5zdGFsbCB0aXBzIGlmIG5vdCBmb3VuZC5cbiAqIEBwYXJhbSB7c3RyaW5nfSBwYWNrYWdlTmFtZVxuICovXG5leHBvcnRzLnRyeVJlcXVpcmUgPSBmdW5jdGlvbiAocGFja2FnZU5hbWUpIHtcblxuICAgIGZ1bmN0aW9uIHRyeVJlcXVpcmVCeShwYWNrYWdlTmFtZSwgbWFpbk1vZHVsZSwgdGhyb3dXaGVuTm90Rm91bmQpIHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIHJldHVybiBtYWluTW9kdWxlLnJlcXVpcmUocGFja2FnZU5hbWUpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaWYgKGVycm9yLmNvZGUgPT09ICdNT0RVTEVfTk9UX0ZPVU5EJykge1xuICAgICAgICAgICAgICAgIGlmICh0aHJvd1doZW5Ob3RGb3VuZCkge1xuICAgICAgICAgICAgICAgICAgICBsZXQgcGtnUGF0aHMgPSBwYWNrYWdlTmFtZS5zcGxpdCgnLycpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgbnBtUGtnTmFtZSA9IHBrZ1BhdGhzWzBdO1xuICAgICAgICAgICAgICAgICAgICBpZiAocGtnUGF0aHNbMF0uc3RhcnRzV2l0aCgnQCcpICYmIHBrZ1BhdGhzLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG5wbVBrZ05hbWUgKz0gJy8nICsgcGtnUGF0aHNbMV07XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYE1vZHVsZSBcIiR7cGFja2FnZU5hbWV9XCIgbm90IGZvdW5kLiBUcnkgcnVuIFwibnBtIGluc3RhbGwgJHtucG1Qa2dOYW1lfVwiIHRvIGluc3RhbGwgdGhlIGRlcGVuZGVuY3kuYCk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ5UmVxdWlyZUJ5KHBhY2thZ2VOYW1lLCBtb2R1bGUpIHx8IHRyeVJlcXVpcmVCeShwYWNrYWdlTmFtZSwgcmVxdWlyZS5tYWluLCB0cnVlKTtcbn07XG5cbi8qKlxuICogQWRkcyBhIHN0YXR1cyBwcm9wZXJ0eSB0byB0aGUgY2xhc3MuXG4gKiBAbWl4aW5cbiAqIEBwYXJhbSB7Kn0gQmFzZSBcbiAqIEBwYXJhbSB7Kn0gU1RBVFVTIFxuICovXG5leHBvcnRzLndpdGhTdGF0dXMgPSAoQmFzZSwgU1RBVFVTKSA9PiBjbGFzcyBleHRlbmRzIEJhc2Uge1xuICAgIC8qKlxuICAgICAqIFN0YXR1cyBjb2RlLlxuICAgICAqIEBtZW1iZXIge251bWJlcn1cbiAgICAgKi9cbiAgICBzdGF0dXMgPSBTVEFUVVM7XG59O1xuXG4vKipcbiAqIEFkZCBhIGV4cG9zZSBwcm9wZXJ0eSB0byB0aGUgZXJyb3Igb2JqZWN0LlxuICogQG1peGluXG4gKiBAcGFyYW0geyp9IEJhc2UgXG4gKi9cbmV4cG9ydHMud2l0aEV4cG9zZSA9IChCYXNlKSA9PiBjbGFzcyBleHRlbmRzIEJhc2Uge1xuICAgIGV4cG9zZSA9IHRydWU7ICAgIFxufTtcblxuLyoqXG4gKiBBZGQgYSBuYW1lIHByb3BlcnR5IG9mIHdoaWNoIHRoZSB2YWx1ZSBpcyB0aGUgY2xhc3MgbmFtZS5cbiAqIEBtaXhpblxuICogQHBhcmFtIHsqfSBCYXNlIFxuICovXG5leHBvcnRzLndpdGhOYW1lID0gKEJhc2UpID0+IGNsYXNzIGV4dGVuZHMgQmFzZSB7ICAgIFxuICAgIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJncyk7XG5cbiAgICAgICAgLyoqXG4gICAgICAgICAqIEVycm9yIG5hbWUuXG4gICAgICAgICAqIEBtZW1iZXIge3N0cmluZ31cbiAgICAgICAgICovXG4gICAgICAgIHRoaXMubmFtZSA9IHRoaXMuY29uc3RydWN0b3IubmFtZTtcbiAgICB9ICAgIFxufTtcblxuLyoqXG4gKiBBZGQgYW4gZXh0cmFJbmZvIHByb3BlcnR5IGFuZCBwYXNzZWQgaW4gYnkgZXh0cmEgY29uc3RydXRvciBhcmd1bWVudHMuXG4gKiBAbWl4aW5cbiAqIEBwYXJhbSB7Kn0gQmFzZSBcbiAqL1xuZXhwb3J0cy53aXRoRXh0cmFJbmZvID0gKEJhc2UpID0+IGNsYXNzIGV4dGVuZHMgQmFzZSB7ICAgIFxuICAgIGNvbnN0cnVjdG9yKC4uLmFyZ3MpIHtcbiAgICAgICAgc3VwZXIoLi4uYXJncyk7XG5cbiAgICAgICAgbGV0IGV4cGVjdGVkTnVtQXJncyA9IHN1cGVyLmNvbnN0cnVjdG9yLmxlbmd0aDtcblxuICAgICAgICBpZiAoYXJncy5sZW5ndGggPiBleHBlY3RlZE51bUFyZ3MpIHtcbiAgICAgICAgICAgIGxldCBleHRyYSA9IGFyZ3Muc2xpY2UoZXhwZWN0ZWROdW1BcmdzKTtcblxuICAgICAgICAgICAgLyoqXG4gICAgICAgICAgICAgKiBFeHRyYSBlcnJvciBpbmZvLlxuICAgICAgICAgICAgICogQG1lbWJlciB7b2JqZWN0fVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICB0aGlzLmV4dHJhSW5mbyA9IGV4dHJhLmxlbmd0aCA+IDEgPyBleHRyYSA6IGV4dHJhWzBdO1xuICAgICAgICB9XG4gICAgfVxufTsiXX0=