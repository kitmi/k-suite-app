"use strict";

require("source-map-support/register");

const {
  _
} = require('rk-utils');

exports.dependsOn = function (features, app, fromFeature) {
  let hasNotEnabled = _.find(_.castArray(features), feature => !app.enabled(feature));

  if (hasNotEnabled) {
    throw new Error(`"${fromFeature}" feature requires "${hasNotEnabled}" feature to be enabled.`);
  }
};

exports.splitControllerAction = function (actionString) {
  let pos = actionString.lastIndexOf('.');

  if (pos <= 0) {
    throw new Error(`Unrecognized controller.action syntax: ${actionString}.`);
  }

  let controller = actionString.substr(0, pos);
  let action = actionString.substr(pos + 1);
  return {
    controller,
    action
  };
};

exports.tryRequire = function (packageName) {
  function tryRequireBy(packageName, mainModule, throwWhenNotFound) {
    try {
      return mainModule.require(packageName);
    } catch (error) {
      if (error.code === 'MODULE_NOT_FOUND') {
        if (throwWhenNotFound) {
          let pkgPaths = packageName.split('/');
          let npmPkgName = pkgPaths[0];

          if (pkgPaths[0].startsWith('@') && pkgPaths.length > 1) {
            npmPkgName += '/' + pkgPaths[1];
          }

          throw new Error(`Module "${packageName}" not found. Try run "npm install ${npmPkgName}" to install the dependency.`);
        }

        return undefined;
      }

      throw error;
    }
  }

  return tryRequireBy(packageName, module) || tryRequireBy(packageName, require.main, true);
};

exports.withExpose = Base => {
  var _temp;

  return _temp = class extends Base {
    constructor(...args) {
      super(...args);
      this.expose = true;
    }

  }, _temp;
};

exports.withName = Base => class extends Base {
  constructor(...args) {
    super(...args);
    this.name = this.constructor.name;
  }

};

exports.withExtraInfo = Base => class extends Base {
  constructor(...args) {
    super(...args);
    let expectedNumArgs = super.constructor.length;

    if (args.length > expectedNumArgs) {
      let extra = args.slice(expectedNumArgs);
      this.extraInfo = extra.length > 1 ? extra : extra[0];
    }
  }

};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlscy9IZWxwZXJzLmpzIl0sIm5hbWVzIjpbIl8iLCJyZXF1aXJlIiwiZXhwb3J0cyIsImRlcGVuZHNPbiIsImZlYXR1cmVzIiwiYXBwIiwiZnJvbUZlYXR1cmUiLCJoYXNOb3RFbmFibGVkIiwiZmluZCIsImNhc3RBcnJheSIsImZlYXR1cmUiLCJlbmFibGVkIiwiRXJyb3IiLCJzcGxpdENvbnRyb2xsZXJBY3Rpb24iLCJhY3Rpb25TdHJpbmciLCJwb3MiLCJsYXN0SW5kZXhPZiIsImNvbnRyb2xsZXIiLCJzdWJzdHIiLCJhY3Rpb24iLCJ0cnlSZXF1aXJlIiwicGFja2FnZU5hbWUiLCJ0cnlSZXF1aXJlQnkiLCJtYWluTW9kdWxlIiwidGhyb3dXaGVuTm90Rm91bmQiLCJlcnJvciIsImNvZGUiLCJwa2dQYXRocyIsInNwbGl0IiwibnBtUGtnTmFtZSIsInN0YXJ0c1dpdGgiLCJsZW5ndGgiLCJ1bmRlZmluZWQiLCJtb2R1bGUiLCJtYWluIiwid2l0aEV4cG9zZSIsIkJhc2UiLCJleHBvc2UiLCJ3aXRoTmFtZSIsImNvbnN0cnVjdG9yIiwiYXJncyIsIm5hbWUiLCJ3aXRoRXh0cmFJbmZvIiwiZXhwZWN0ZWROdW1BcmdzIiwiZXh0cmEiLCJzbGljZSIsImV4dHJhSW5mbyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7QUFPQyxNQUFNO0FBQUVBLEVBQUFBO0FBQUYsSUFBUUMsT0FBTyxDQUFDLFVBQUQsQ0FBckI7O0FBT0RDLE9BQU8sQ0FBQ0MsU0FBUixHQUFvQixVQUFVQyxRQUFWLEVBQW9CQyxHQUFwQixFQUF5QkMsV0FBekIsRUFBc0M7QUFDdEQsTUFBSUMsYUFBYSxHQUFHUCxDQUFDLENBQUNRLElBQUYsQ0FBT1IsQ0FBQyxDQUFDUyxTQUFGLENBQVlMLFFBQVosQ0FBUCxFQUE4Qk0sT0FBTyxJQUFJLENBQUNMLEdBQUcsQ0FBQ00sT0FBSixDQUFZRCxPQUFaLENBQTFDLENBQXBCOztBQUVBLE1BQUlILGFBQUosRUFBbUI7QUFDZixV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Q0FBWjtBQU1BLFdBQUtHLFNBQUwsR0FBaUJGLEtBQUssQ0FBQ2IsTUFBTixHQUFlLENBQWYsR0FBbUJhLEtBQW5CLEdBQTJCQSxLQUFLLENBQUMsQ0FBRCxDQUFqRDtBQUNIO0FBQ0o7O0FBZmdELENBQXJEIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qKlxuICogQ29tbW9uIGhlbHBlcnMgZm9yIHNlcnZpY2UgY29udGFpbmVyLlxuICogQG1vZHVsZSBIZWxwZXJzXG4gKi8gXG5cbiBjb25zdCB7IF8gfSA9IHJlcXVpcmUoJ3JrLXV0aWxzJyk7XG5cbiAvKipcbiAgKiBAcGFyYW0ge3N0cmluZ3xhcnJheS48c3RyaW5nPn0gZmVhdHVyZXMgLSBEZXBlbmRlbmNpZXMgb2Ygb3RoZXIgZmVhdHVyZXMuXG4gICogQHBhcmFtIHtTZXJ2aWNlQ29udGFpbmVyfSBhcHAgLSBPcmlnaW4gc2VydmljZSBjb250YWluZXIgYXBwLlxuICAqIEBwYXJhbSB7c3RyaW5nfSBmcm9tRmVhdHVyZSAtIERlcGVuZGVudCBmZWF0dXJlLlxuICAqL1xuZXhwb3J0cy5kZXBlbmRzT24gPSBmdW5jdGlvbiAoZmVhdHVyZXMsIGFwcCwgZnJvbUZlYXR1cmUpIHtcbiAgICBsZXQgaGFzTm90RW5hYmxlZCA9IF8uZmluZChfLmNhc3RBcnJheShmZWF0dXJlcyksIGZlYXR1cmUgPT4gIWFwcC5lbmFibGVkKGZlYXR1cmUpKTtcblxuICAgIGlmIChoYXNOb3RFbmFibGVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihgXCIke2Zyb21GZWF0dXJlfVwiIGZlYXR1cmUgcmVxdWlyZXMgXCIke2hhc05vdEVuYWJsZWR9XCIgZmVhdHVyZSB0byBiZSBlbmFibGVkLmApO1xuICAgIH1cbn07XG5cbmV4cG9ydHMuc3BsaXRDb250cm9sbGVyQWN0aW9uID0gZnVuY3Rpb24gKGFjdGlvblN0cmluZykge1xuICAgIGxldCBwb3MgPSBhY3Rpb25TdHJpbmcubGFzdEluZGV4T2YoJy4nKTtcbiAgICBpZiAocG9zIDw9IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBVbnJlY29nbml6ZWQgY29udHJvbGxlci5hY3Rpb24gc3ludGF4OiAke2FjdGlvblN0cmluZ30uYCk7XG4gICAgfVxuXG4gICAgbGV0IGNvbnRyb2xsZXIgPSBhY3Rpb25TdHJpbmcuc3Vic3RyKDAsIHBvcyk7XG4gICAgbGV0IGFjdGlvbiA9IGFjdGlvblN0cmluZy5zdWJzdHIocG9zICsgMSk7XG5cbiAgICByZXR1cm4geyBjb250cm9sbGVyLCBhY3Rpb24gfTtcbn07XG5cbi8qKlxuICogVHJ5IHJlcXVpcmUgYSBwYWNrYWdlIG1vZHVsZSBhbmQgc2hvdyBpbnN0YWxsIHRpcHMgaWYgbm90IGZvdW5kLlxuICogQHBhcmFtIHtzdHJpbmd9IHBhY2thZ2VOYW1lXG4gKi9cbmV4cG9ydHMudHJ5UmVxdWlyZSA9IGZ1bmN0aW9uIChwYWNrYWdlTmFtZSkge1xuXG4gICAgZnVuY3Rpb24gdHJ5UmVxdWlyZUJ5KHBhY2thZ2VOYW1lLCBtYWluTW9kdWxlLCB0aHJvd1doZW5Ob3RGb3VuZCkge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgcmV0dXJuIG1haW5Nb2R1bGUucmVxdWlyZShwYWNrYWdlTmFtZSk7XG4gICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBpZiAoZXJyb3IuY29kZSA9PT0gJ01PRFVMRV9OT1RfRk9VTkQnKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRocm93V2hlbk5vdEZvdW5kKSB7XG4gICAgICAgICAgICAgICAgICAgIGxldCBwa2dQYXRocyA9IHBhY2thZ2VOYW1lLnNwbGl0KCcvJyk7XG4gICAgICAgICAgICAgICAgICAgIGxldCBucG1Qa2dOYW1lID0gcGtnUGF0aHNbMF07XG4gICAgICAgICAgICAgICAgICAgIGlmIChwa2dQYXRoc1swXS5zdGFydHNXaXRoKCdAJykgJiYgcGtnUGF0aHMubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgbnBtUGtnTmFtZSArPSAnLycgKyBwa2dQYXRoc1sxXTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihgTW9kdWxlIFwiJHtwYWNrYWdlTmFtZX1cIiBub3QgZm91bmQuIFRyeSBydW4gXCJucG0gaW5zdGFsbCAke25wbVBrZ05hbWV9XCIgdG8gaW5zdGFsbCB0aGUgZGVwZW5kZW5jeS5gKTtcbiAgICAgICAgICAgICAgICB9ICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdGhyb3cgZXJyb3I7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdHJ5UmVxdWlyZUJ5KHBhY2thZ2VOYW1lLCBtb2R1bGUpIHx8IHRyeVJlcXVpcmVCeShwYWNrYWdlTmFtZSwgcmVxdWlyZS5tYWluLCB0cnVlKTtcbn07XG5cbi8qKlxuICogQWRkIGEgZXhwb3NlIHByb3BlcnR5IHRvIHRoZSBlcnJvciBvYmplY3QuXG4gKiBAbWl4aW5cbiAqIEBwYXJhbSB7Kn0gQmFzZSBcbiAqL1xuZXhwb3J0cy53aXRoRXhwb3NlID0gKEJhc2UpID0+IGNsYXNzIGV4dGVuZHMgQmFzZSB7XG4gICAgZXhwb3NlID0gdHJ1ZTsgICAgXG59O1xuXG4vKipcbiAqIEFkZCBhIG5hbWUgcHJvcGVydHkgb2Ygd2hpY2ggdGhlIHZhbHVlIGlzIHRoZSBjbGFzcyBuYW1lLlxuICogQG1peGluXG4gKiBAcGFyYW0geyp9IEJhc2UgXG4gKi9cbmV4cG9ydHMud2l0aE5hbWUgPSAoQmFzZSkgPT4gY2xhc3MgZXh0ZW5kcyBCYXNlIHsgICAgXG4gICAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgICAgICBzdXBlciguLi5hcmdzKTtcblxuICAgICAgICAvKipcbiAgICAgICAgICogRXJyb3IgbmFtZS5cbiAgICAgICAgICogQG1lbWJlciB7c3RyaW5nfVxuICAgICAgICAgKi9cbiAgICAgICAgdGhpcy5uYW1lID0gdGhpcy5jb25zdHJ1Y3Rvci5uYW1lO1xuICAgIH0gICAgXG59O1xuXG4vKipcbiAqIEFkZCBhbiBleHRyYUluZm8gcHJvcGVydHkgYW5kIHBhc3NlZCBpbiBieSBleHRyYSBjb25zdHJ1dG9yIGFyZ3VtZW50cy5cbiAqIEBtaXhpblxuICogQHBhcmFtIHsqfSBCYXNlIFxuICovXG5leHBvcnRzLndpdGhFeHRyYUluZm8gPSAoQmFzZSkgPT4gY2xhc3MgZXh0ZW5kcyBCYXNlIHsgICAgXG4gICAgY29uc3RydWN0b3IoLi4uYXJncykge1xuICAgICAgICBzdXBlciguLi5hcmdzKTtcblxuICAgICAgICBsZXQgZXhwZWN0ZWROdW1BcmdzID0gc3VwZXIuY29uc3RydWN0b3IubGVuZ3RoO1xuXG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA+IGV4cGVjdGVkTnVtQXJncykge1xuICAgICAgICAgICAgbGV0IGV4dHJhID0gYXJncy5zbGljZShleHBlY3RlZE51bUFyZ3MpO1xuXG4gICAgICAgICAgICAvKipcbiAgICAgICAgICAgICAqIEV4dHJhIGVycm9yIGluZm8uXG4gICAgICAgICAgICAgKiBAbWVtYmVyIHtvYmplY3R9XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgIHRoaXMuZXh0cmFJbmZvID0gZXh0cmEubGVuZ3RoID4gMSA/IGV4dHJhIDogZXh0cmFbMF07XG4gICAgICAgIH1cbiAgICB9XG59OyJdfQ==